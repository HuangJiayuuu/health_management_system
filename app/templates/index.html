{% extends "base.html" %}

{% block content %}
    <article>
        <header>
            <h2>你好, {{ current_user.username }}!</h2>
            <p>欢迎回到你的健康仪表盘。这是你过去一周的目标完成情况：</p>
        </header>

        {% if not general_goal and not exercise_progress_list %}
            <p>你还没有设定任何健康目标。</p>
            <a href="{{ url_for('goals') }}" role="button">点击这里去设定你的第一个目标！</a>
        {% else %}
            
            {% if general_goal %}
            <div class="grid">
                {% if general_progress.sleep %}
                <div>
                    <label for="sleep_progress">每日平均睡眠</label>
                    <progress id="sleep_progress" value="{{ general_progress.sleep.progress|int }}" max="100"></progress>
                    <small>当前: {{ "%.1f"|format(general_progress.sleep.current) }} 小时 / 目标: {{ general_progress.sleep.target }} 小时</small>
                </div>
                {% endif %}
                {% if general_progress.calories %}
                <div>
                    <label for="calorie_progress">每日平均热量摄入</label>
                    <progress id="calorie_progress" value="{{ general_progress.calories.current }}" max="{{ general_progress.calories.target }}"></progress>
                    <small>当前: {{ "%.0f"|format(general_progress.calories.current) }} 大卡 / 目标: {{ general_progress.calories.target }} 大卡</small>
                </div>
                {% endif %}
            </div>
            {% endif %}

            {% if exercise_progress_list %}
                <hr>
                <h4>本周运动目标进度</h4>
                {% for item in exercise_progress_list %}
                <div>
                    <label for="exercise_progress_{{ loop.index }}">
                        {{ item.goal.goal_type|replace('duration', '总时长')|replace('frequency', '总次数')|replace('calories', '总热量') }}
                        {% if item.goal.exercise_type %}({{ item.goal.exercise_type }}){% endif %}
                    </label>
                    <progress id="exercise_progress_{{ loop.index }}" value="{{ item.progress|int }}" max="100"></progress>
                    <small>
                        当前: {{ "%.1f"|format(item.current) }} / 目标: {{ item.target }}
                        {% if item.goal.goal_type == 'duration' %}分钟{% elif item.goal.goal_type == 'frequency' %}次{% elif item.goal.goal_type == 'calories' %}大卡{% endif %}
                    </small>
                </div>
                <br>
                {% endfor %}
            {% endif %}

        {% endif %}

    </article>
{% endblock %}
