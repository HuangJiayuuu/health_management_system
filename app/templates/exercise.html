{% extends "base.html" %}

{% block content %}
<div class="grid">
    <div_col="1of2">
        <h2>添加新运动记录</h2>
        <form action="{{ url_for('exercise') }}" method="post" novalidate>
            {{ form.hidden_tag() }}
            <p>
                {{ form.exercise_date.label }}<br>
                {{ form.exercise_date(id="exercise_date_picker") }}
            </p>
            <p>
                {{ form.exercise_type.label }}<br>
                {{ form.exercise_type(id="exercise_type_select") }}
            </p>
            <p>
                {{ form.duration.label }}<br>
                {{ form.duration() }}
            </p>
            <p id="calories_field">
                {{ form.calories_burned.label }}<br>
                {{ form.calories_burned() }}
                {% for error in form.calories_burned.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
            <p>{{ form.submit() }}</p>
        </form>
    </div>
    <div_col="1of2">
        <h2>历史运动记录</h2>
        {% for record in exercise_records %}
        <article style="padding: 0.75rem 1rem;">
            <div class="grid" style="grid-template-columns: 1fr auto; align-items: center; gap: 1rem;">
                <p style="margin: 0;">{{ record.timestamp.strftime('%Y-%m-%d') }}: {{ record.exercise_type }} - {{ record.duration }} 分钟, 消耗 {{ "%.1f"|format(record.calories_burned) }} 大卡</p>
                <form action="{{ url_for('delete_exercise', record_id=record.id) }}" method="post" onsubmit="return confirm('你确定要删除这条记录吗？');" style="margin: 0;">
                    <button type="submit" class="secondary outline" style="margin: 0; padding: 0.25rem 0.5rem; font-size: 0.8rem;">删除</button>
                </form>
            </div>
        </article>
        {% else %}
        <p>你还没有任何运动记录。</p>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const exerciseTypeSelect = document.getElementById('exercise_type_select');
        const caloriesField = document.getElementById('calories_field');

        function toggleCaloriesField() {
            if (exerciseTypeSelect.value === '其它') {
                caloriesField.style.display = 'block';
            } else {
                caloriesField.style.display = 'none';
            }
        }

        // Initial check
        toggleCaloriesField();

        // Listen for changes
        exerciseTypeSelect.addEventListener('change', toggleCaloriesField);
    });

    flatpickr("#exercise_date_picker", {
        dateFormat: "Y-m-d",
        defaultDate: "today",
        locale: "zh"
    });
</script>
{% endblock %} 